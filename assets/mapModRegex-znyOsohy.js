function l(e,t){const i=e.match(/\d/g);if(i===null)return"";const r=t?Math.floor(Number(i.join(""))/10)*10:Number(i.join(""));if(isNaN(r)||r===0)return t&&i.length===1?".":"";if(r>=200)return`[${y(y(r))}-9]..`;if(r>=150){const n=r.toString(),c=n[0],u=n[1],o=n[2];return n[1]==="0"&&n[2]==="0"?`([2-9]..|${c}..)`:n[2]==="0"?`([2-9]..|1[${u}-9].)`:n[1]==="0"?`([2-9]..|\\d0[${o}-9]|\\d[1-9].)`:n[1]==="9"&&n[2]==="9"?"([2-9]..|199)":u==="9"?`([2-9]..|19[${o}-9])`:`[12]([${u}-9][${o}-9]|[${Number(u)+1}-9].)`}if(r>100){const n=r.toString(),c=n[0],u=n[1],o=n[2];return n[1]==="0"&&n[2]==="0"?`${c}..`:n[2]==="0"?`(1[${u}-9].|[2-9]..)`:n[1]==="0"?`(\\d0[${o}-9]|\\d[1-9].)`:n[1]==="9"&&n[2]==="9"?"(199|[2-9]..)":u==="9"?`19[${o}-9]`:`(1([${u}-9][${o}-9]|[${Number(u)+1}-9].)|[2-9]..)`}if(r===100)return"\\d..";if(r>9){const n=r.toString(),c=n[0],u=n[1];return n[1]==="0"?`([${c}-9].|\\d..)`:n[0]==="9"?`(${c}[${u}-9]|\\d..)`:`(${c}[${u}-9]|[${Number(c)+1}-9].|\\d..)`}return r<=9?`([${r}-9]|\\d..?)`:e}function y(e){return Math.floor(e/10)}function x(e){return[...new Set(e)]}function g(e,t){const i=t.tokens.find(r=>e===r.id);return i?i.regex:void 0}function R(e,t){const i=t.tokens.map(n=>n.id),r=e.filter(n=>i.includes(n));return k(r,t)}function k(e,t){const i=e.length,r=t.optimizationTable,n=q(i),c=b(e,n);let u=[];const d=c.reduce((a,m)=>{const s=r[m];if(s===void 0||!s.ids.every($=>a.includes($)))return a;{u=u.concat(s.regex);const $=s.ids;return a.filter(z=>!$.some(h=>h===z))}},e).map(a=>t.tokens.find(m=>m.id===a)).filter(a=>a!==void 0),p=u.concat(d.map(a=>a.regex));return x(p)}function q(e){return e<15?8:e<18?7:e<21?6:e<28?5:4}function b(e,t){const i=[];function n(c,u){u.length>=2&&u.length<=t&&i.push(u.join(":"));for(let o=c;o<e.length;o++)u.length<t&&n(o+1,[...u,e[o]])}return n(0,[]),i.sort((c,u)=>u.length-c.length)}function Q(e,t,i){return i.indexOf(e)===t}function f(e,t){return t===""?"":`"${e}${t}%"`}function j(e,t,i,r){if(e&&t&&i)return r?"":'"!y: (n|m|r)"';const o=[e?"n":"",t?"m":"",i?"r":""].filter(p=>p.length>0).join("|"),d=r?"":"!";return o.length===0?"":o.length===1?`"${d}y: ${o}"`:o.length>1?`"${d}y: (${o})"`:""}function M(e,t){return e.badIds.length===0?"":`"!${R(e.badIds,t).join("|")}"`}function v(e,t){if(e.goodIds.length===0)return"";const i=e.goodIds.map(r=>g(r,t)).filter(r=>r!==void 0).filter(Q);return e.allGoodMods?i.map(r=>r.includes(" ")?`"${r}"`:r).join(" "):`"${i.join("|")}"`}function I(e){function t(r){return r==="regular"?"lity:.*":r==="currency"?"urr.*":r==="divination"?"div.*":r==="rarity"?"ty\\).*":r==="pack size"?"ze\\).*":r==="scarab"?"sca.*":""}const i=[f(t("regular"),l(e.quality.regular,e.optimizeQuality)),f(t("currency"),l(e.quality.currency,e.optimizeQuality)),f(t("divination"),l(e.quality.divination,e.optimizeQuality)),f(t("rarity"),l(e.quality.rarity,e.optimizeQuality)),f(t("pack size"),l(e.quality.packSize,e.optimizeQuality)),f(t("scarab"),l(e.quality.scarab,e.optimizeQuality))].filter(r=>r!=="");return e.anyQuality?i.length===0?"":`"${i.map(n=>n.slice(1,-1)).join("|")}"`:i.join(" ")}function N(e){return e.corrupted.enabled?e.corrupted.include?"pte":"!pte":""}function T(e){return e.unidentified.enabled?e.unidentified.include?"tified":"!tified":""}function S(e){return e.replaceAll('"!"',"").replaceAll("[8-9]","[89]").replaceAll("[9-9]","9")}function A(e,t){const i=M(e,t),r=v(e,t),n=f("m q.*",l(e.quantity,e.optimizeQuant)),c=f("iz.*",l(e.packsize,e.optimizePacksize)),u=f("re maps.*",l(e.mapDropChance,!1)),o=f("m rar.*",l(e.itemRarity,!1)),d=I(e),p=j(e.rarity.normal,e.rarity.magic,e.rarity.rare,e.rarity.include),a=N(e),m=T(e),s=`${i} ${r} ${n} ${c} ${o} ${d} ${p} ${u} ${a} ${m}`.trim().replaceAll(/\s{2,}/g," ");return S(s)}export{l as a,A as g};
